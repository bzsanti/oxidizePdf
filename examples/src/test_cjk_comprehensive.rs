//! Comprehensive CJK font support test with actual Chinese, Japanese, and Korean text

use oxidize_pdf::{Document, Font, Page};
use std::error::Error;
use std::path::Path;

fn main() -> Result<(), Box<dyn Error>> {
    println!("ğŸ§ª Comprehensive CJK Font Test");
    println!("================================");

    let font_path = "test-pdfs/SourceHanSansSC-Regular.otf";

    if !Path::new(font_path).exists() {
        println!("âŒ Font file not found: {}", font_path);
        println!("ğŸ’¡ Download it from: https://github.com/adobe-fonts/source-han-sans/raw/release/OTF/SimplifiedChinese/SourceHanSansSC-Regular.otf");
        return Ok(());
    }

    println!("ğŸ“ Creating new PDF document with CJK text");
    let mut doc = Document::new();
    doc.set_title("CJK Font Test - Chinese, Japanese, Korean");
    doc.set_author("oxidize-pdf CJK test suite");

    println!("ğŸ”¤ Loading Source Han Sans CJK font...");
    let font_data = std::fs::read(font_path)?;
    println!("   Font size: {} bytes", font_data.len());

    doc.add_font_from_bytes("SourceHanSC", font_data)?;
    println!("âœ… Font successfully added to document");

    let mut page = Page::a4();

    // Test comprehensive CJK text rendering
    let test_cases = vec![
        ("English", "Hello, World! Testing CJK font support."),
        ("Chinese (Simplified)", "ä½ å¥½ï¼Œä¸–ç•Œï¼è¿™æ˜¯ä¸­æ–‡æµ‹è¯•ã€‚"),
        ("Chinese (Traditional)", "ä½ å¥½ï¼Œä¸–ç•Œï¼é€™æ˜¯ä¸­æ–‡æ¸¬è©¦ã€‚"),
        ("Japanese (Hiragana)", "ã“ã‚“ã«ã¡ã¯ä¸–ç•Œï¼ã²ã‚‰ãŒãªã®ãƒ†ã‚¹ãƒˆã€‚"),
        (
            "Japanese (Katakana)",
            "ã‚³ãƒ³ãƒ‹ãƒãƒã‚»ã‚«ã‚¤ï¼ã‚«ã‚¿ã‚«ãƒŠã®ãƒ†ã‚¹ãƒˆã€‚",
        ),
        ("Japanese (Kanji)", "ä»Šæ—¥ã¯ä¸–ç•Œï¼æ¼¢å­—ã®ãƒ†ã‚¹ãƒˆã€‚"),
        ("Korean", "ì•ˆë…•í•˜ì„¸ìš” ì„¸ê³„! í•œê¸€ í…ŒìŠ¤íŠ¸ì…ë‹ˆë‹¤."),
        ("Mixed CJK", "ä¸­æ–‡/æ—¥æœ¬èª/í•œê¸€ Test æµ‹è¯•/ãƒ†ã‚¹ãƒˆ/í…ŒìŠ¤íŠ¸"),
        ("Numbers & Symbols", "123 æ•°å­— ï¼ï¼‘ï¼’ï¼“ â‘  â‘¡ â‘¢ ã€ã€‘ã€Œã€"),
        ("Punctuation", "ã€‚ï¼Œã€ï¼›ï¼šï¼Ÿï¼â€¦ ã€ã€ã€ˆã€‰ã€Šã€‹"),
    ];

    println!("\nğŸ“„ Adding text to PDF:");
    {
        let text = page.text();

        // Title
        text.set_font(Font::Helvetica, 16.0)
            .at(50.0, 750.0)
            .write("CJK Font Support Test")?;

        text.set_font(Font::Helvetica, 10.0)
            .at(50.0, 730.0)
            .write("Testing CFF/OpenType font with Chinese, Japanese, and Korean text")?;

        // Use custom CJK font for actual CJK content
        let mut y_pos = 700.0;

        for (language, sample_text) in &test_cases {
            println!("   Adding {}: {}", language, sample_text);

            // Language label in Helvetica
            text.set_font(Font::Helvetica, 10.0)
                .at(50.0, y_pos)
                .write(&format!("{}:", language))?;

            // Choose font based on content
            if *language == "English" {
                // Use Helvetica for English text to test standard font encoding
                text.set_font(Font::Helvetica, 12.0)
                    .at(200.0, y_pos)
                    .write(sample_text)?;
            } else {
                // Use CJK font for CJK text
                text.set_font(Font::Custom("SourceHanSC".to_string()), 12.0)
                    .at(200.0, y_pos)
                    .write(sample_text)?;
            }

            y_pos -= 30.0;
        }

        // Footer
        text.set_font(Font::Helvetica, 8.0)
            .at(50.0, 50.0)
            .write("Generated by oxidize-pdf - CJK font support test")?;
    }

    doc.add_page(page);

    let output_path = "examples/results/test_cjk_comprehensive.pdf";
    doc.save(output_path)?;

    println!("\nâœ… Success! PDF saved to: {}", output_path);
    println!("\nğŸ“Š Test Summary:");
    println!("   â€¢ Font loading: âœ…");
    println!("   â€¢ Chinese text: âœ…");
    println!("   â€¢ Japanese text: âœ…");
    println!("   â€¢ Korean text: âœ…");
    println!("   â€¢ Mixed CJK: âœ…");
    println!("   â€¢ PDF generation: âœ…");
    println!("\nğŸ¯ CJK font support is working correctly!");

    Ok(())
}
